<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />

    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <div class="sidebar">
      <h3 class="sidebar-title">APP</h3>
      <div class="sidebar-section">Device</div>
      <a
        class="sidebar-item active"
        data-icon="ðŸ“±"
        onclick="loadPage('devices')"
      >
        Device
      </a>
      <div class="sidebar-section">Instagram</div>
      <a class="sidebar-item" data-icon="â¤ï¸" onclick="loadPage('like')">Like</a>
      <a class="sidebar-item" data-icon="ðŸ’¬" onclick="loadPage('comment')"
        >Komen</a
      >
      <a class="sidebar-item" data-icon="ðŸ‘¤" onclick="loadPage('follow')"
        >Follow</a
      >
      <hr />
      <div class="sidebar-section">Report</div>
      <a
        class="sidebar-item"
        data-page="report"
        data-icon="ðŸ“„"
        onclick="loadPage('report')"
      >
        Report Log
      </a>
      <hr />
      <div class="logout-wrapper">
        <a class="sidebar-logout" data-icon="âŒ" onclick="window.close()"
          >Keluar</a
        >
      </div>
      <div
        class="sidebar-version text-center mt-2 mb-3"
        style="font-size: 11px; opacity: 0.6"
      >
        Version: <span id="appVersion">...</span>
      </div>
    </div>

    <div class="content">
      <div class="topbar">
        <div class="topbar-left">
          <button id="toggleSidebar" class="btn-hamburger">â˜°</button>
          <h4 id="breadcrumb">Dashboard</h4>
        </div>
      </div>

      <div id="pageContainer" class="p-3"></div>
    </div>
    <div class="notify-container" id="notifyContainer"></div>

    <script src="assets/js/dashboard.js"></script>

    <script>
      /* ============================================================
        FUNCTION UTILITY
    ============================================================ */
      function getInitials(name) {
        return name
          .split(" ")
          .map((w) => w[0])
          .join("")
          .toUpperCase();
      }

      /* ============================================================
        UPDATE SIDEBAR (RESPONSIVE + RESTORE DOWN)
    ============================================================ */
      async function updateSidebar(initials) {
        const sidebar = document.querySelector(".sidebar");
        const content = document.querySelector(".content");
        const sidebarTitle = document.querySelector(".sidebar-title");
        const appName = await window.api.getAppName();

        if (window.innerWidth < 900) {
          sidebar.classList.add("collapsed");
          content.classList.add("collapsed");
          sidebar.dataset.locked = "true";
          sidebarTitle.innerText = initials;
          return;
        }

        sidebar.dataset.locked = "false";
        sidebar.classList.remove("collapsed");
        content.classList.remove("collapsed");
        sidebarTitle.innerText = appName;
      }

      /* ============================================================
        INIT LOAD
    ============================================================ */
      window.addEventListener("DOMContentLoaded", async () => {
        const appName = await window.api.getAppName();
        const appVersion = await window.api.getAppVersion();
        const initials = getInitials(appName);

        document.title = appName;
        document.getElementById("appVersion").innerText = appVersion;
        document.querySelector(".sidebar-title").innerText = appName;

        document.getElementById("breadcrumb").innerText =
          appName + " / Dashboard";
        autoScanFull();
        updateSidebar(initials);
      });

      /* ============================================================
        RESIZE HANDLER
    ============================================================ */
      window.addEventListener("resize", async () => {
        const appName = await window.api.getAppName();
        updateSidebar(getInitials(appName));
      });

      /* ============================================================
        TOGGLE SIDEBAR
    ============================================================ */
      document.getElementById("toggleSidebar").onclick = async () => {
        const sidebar = document.querySelector(".sidebar");
        if (sidebar.dataset.locked === "true") return;

        const content = document.querySelector(".content");
        const sidebarTitle = document.querySelector(".sidebar-title");

        const appName = await window.api.getAppName();
        const initials = getInitials(appName);

        sidebar.classList.toggle("collapsed");
        content.classList.toggle("collapsed");

        sidebarTitle.innerText = sidebar.classList.contains("collapsed")
          ? initials
          : appName;
      };

      async function autoScanFull() {
        const container = document.getElementById("pageContainer");

        container.innerHTML = `
        <div class="text-center p-5">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
            <p class="mt-3 fs-5">Sedang melakukan scanning device...</p>
            <p class="text-muted">Mohon tunggu beberapa saat</p>
        </div>
    `;

        const result = await window.api.scanFull();

        devices = result;
        sessionStorage.setItem("devices", JSON.stringify(result));

        loadDevicePage();
      }
    </script>
  </body>
</html>
